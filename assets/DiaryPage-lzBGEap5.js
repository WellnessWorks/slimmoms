import{r as l,n as h,j as e,N as V,m as X}from"./index-Bmanl6Pj.js";import{S as F}from"./SummaryCard-CJScG-Nx.js";const Z="_page_1blii_1",ee="_inner_1blii_10",te="_left_1blii_18",ae="_right_1blii_23",se="_dateRow_1blii_27",le="_dateText_1blii_34",ne="_form_1blii_55",ie="_formRow_1blii_59",re="_field_1blii_65",oe="_fieldSmall_1blii_71",de="_label_1blii_75",ce="_input_1blii_83",ue="_suggestions_1blii_97",me="_suggestionItem_1blii_111",he="_tableWrapper_1blii_121",be="_table_1blii_121",pe="_deleteBtn_1blii_171",ge="_emptyText_1blii_183",_e="_error_1blii_189",fe="_addBtnCircle_1blii_195",xe="_calendarBtn_1blii_212",ye="_calendarIcon_1blii_223",je="_hiddenDateInput_1blii_254",Ne="_addBtnMobile_1blii_267",we="_mobileAddHeader_1blii_287",Se="_backBtn_1blii_294",ve="_mobileAddTitle_1blii_301",Be="_summaryBox_1blii_306",Re="_warning_1blii_314",t={page:Z,inner:ee,left:te,right:ae,dateRow:se,dateText:le,form:ne,formRow:ie,field:re,fieldSmall:oe,label:de,input:ce,suggestions:ue,suggestionItem:me,tableWrapper:he,table:be,deleteBtn:pe,emptyText:ge,error:_e,addBtnCircle:fe,calendarBtn:xe,calendarIcon:ye,hiddenDateInput:je,addBtnMobile:Ne,mobileAddHeader:we,backBtn:Se,mobileAddTitle:ve,summaryBox:Be,warning:Re},Ae=()=>{const i=new Date;return`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}-${String(i.getDate()).padStart(2,"0")}`},Ee=()=>{const i=localStorage.getItem("token"),[b]=l.useState(Ae),[d,E]=l.useState(b),[c,B]=l.useState(null),[D,W]=l.useState([]),[P,H]=l.useState(null),[u,_]=l.useState(""),[f,R]=l.useState([]),[o,x]=l.useState(null),[m,A]=l.useState(""),[T,y]=l.useState([]),[j,N]=l.useState(0),[w,p]=l.useState(null),[S,k]=l.useState(null),[Y,M]=l.useState(!1),[G,L]=l.useState(!1),[g,U]=l.useState(typeof window<"u"?window.innerWidth<=704:!1),[K,C]=l.useState(!1),[Q,q]=l.useState(!0);l.useEffect(()=>{const a=()=>U(window.innerWidth<=769);return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]),l.useEffect(()=>{if(!i)return;(async()=>{try{const{data:s}=await h.get("/api/v1/users/me",{headers:{Authorization:`Bearer ${i}`}}),n=s.user||s;if(n.dailyCalorieGoal&&B(n.dailyCalorieGoal),n.dailyRate&&B(n.dailyRate),n.bloodGroup){H(n.bloodGroup);const r=await h.get(`/api/v1/products/forbidden?bloodGroup=${n.bloodGroup}`,{headers:{Authorization:`Bearer ${i}`}});Array.isArray(r.data.forbiddenFoods)&&W(r.data.forbiddenFoods)}}catch(s){console.error("PROFILE ERROR:",s)}})()},[i]),l.useEffect(()=>{if(!i)return;(async()=>{M(!0),p(null);try{const{data:s}=await h.get(`/api/v1/day/info?date=${d}`,{headers:{Authorization:`Bearer ${i}`}});y((s.products||[]).map(n=>({id:n.id||n._id,title:n.title,weight:n.weight,calories:n.calories}))),N(s.consumedCalories||0),B(s.dailyGoal||c)}catch(s){console.error("DAY INFO ERROR:",s),p("Could not load daily information for this date."),y([]),N(0)}finally{M(!1),q(!1)}})()},[d,i]),l.useEffect(()=>{if(!i)return;if(!u.trim())return R([]);if(o&&u===o.title)return;const a=setTimeout(async()=>{try{const{data:s}=await h.get(`/api/v1/products/search?query=${encodeURIComponent(u)}`,{headers:{Authorization:`Bearer ${i}`}});R(s.products||[])}catch(s){console.error("SEARCH ERROR:",s)}},300);return()=>clearTimeout(a)},[u,i,o]);const $=a=>{x(a),_(a.title),R([])},z=async a=>{if(a.preventDefault(),!(!o||!m)){if(d>b){p("You can only add products for today or past dates.");return}if(p(null),k(null),P&&o.groupBloodNotAllowed&&Array.isArray(o.groupBloodNotAllowed)){const s=Number(P)-1;o.groupBloodNotAllowed[s]&&k("⚠️ This product is not recommended for your blood group.")}L(!0);try{const s={date:d,productId:o._id,weight:Number(m)},{data:n}=await h.post("/api/v1/day/add-product",s,{headers:{Authorization:`Bearer ${i}`}}),r=n.day;r&&(y(r.consumedProducts.map(v=>({id:v._id,title:v.title,weight:v.weight,calories:v.calories}))),N(r.totalCalories)),_(""),x(null),A(""),g&&C(!1)}catch(s){console.error("ADD PRODUCT ERROR:",s),p("Could not add this product.")}finally{L(!1)}}},J=async a=>{try{const{data:s}=await h.delete("/api/v1/day/delete-product",{headers:{Authorization:`Bearer ${i}`},data:{consumedProductId:a}}),n=s.day;n&&(y(n.consumedProducts.map(r=>({id:r._id,title:r.title,weight:r.weight,calories:r.calories}))),N(n.totalCalories))}catch(s){console.error("DELETE ERROR:",s)}},I=l.useMemo(()=>new Date(d).toLocaleDateString("tr-TR",{day:"2-digit",month:"2-digit",year:"numeric"}),[d]),O=l.useMemo(()=>!c||c<=0?0:Math.round(j/c*100),[c,j]);return i?Q?e.jsx(X,{full:!0,size:60}):g&&K?e.jsx("section",{className:t.page,children:e.jsx("div",{className:t.inner,children:e.jsxs("div",{className:t.left,children:[e.jsxs("div",{className:t.mobileAddHeader,children:[e.jsx("button",{type:"button",className:t.backBtn,onClick:()=>C(!1),children:"←"}),e.jsx("span",{className:t.mobileAddTitle,children:"Add product"})]}),e.jsxs("form",{className:t.form,onSubmit:z,children:[e.jsxs("div",{className:t.formRow,children:[e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Enter product name"}),e.jsx("input",{className:t.input,type:"text",value:u,onChange:a=>{_(a.target.value),x(null)},placeholder:"Eggplant"}),f.length>0&&e.jsx("ul",{className:t.suggestions,children:f.map(a=>e.jsx("li",{onClick:()=>$(a),className:t.suggestionItem,children:a.title},a._id))})]}),e.jsxs("div",{className:t.fieldSmall,children:[e.jsx("label",{className:t.label,children:"Grams"}),e.jsx("input",{className:t.input,type:"number",value:m,min:"1",onChange:a=>A(a.target.value),placeholder:"100"})]})]}),w&&e.jsx("p",{className:t.error,children:w}),S&&e.jsx("p",{className:t.warning,children:S}),e.jsx("button",{type:"submit",className:t.addBtnMobile,disabled:!o||!m||G,children:"Add"})]})]})})}):e.jsx("section",{className:t.page,children:e.jsxs("div",{className:t.inner,children:[e.jsxs("div",{className:t.left,children:[e.jsxs("div",{className:t.dateRow,children:[e.jsx("span",{className:t.dateText,children:I}),e.jsx("button",{type:"button",className:t.calendarBtn,onClick:()=>document.getElementById("hiddenDatePicker").showPicker(),children:e.jsx("span",{className:t.calendarIcon})}),e.jsx("input",{id:"hiddenDatePicker",type:"date",className:t.hiddenDateInput,value:d,max:b,onChange:a=>{const s=a.target.value;s>b?E(b):E(s)}})]}),!g&&e.jsxs("form",{className:t.form,onSubmit:z,children:[e.jsxs("div",{className:t.formRow,children:[e.jsxs("div",{className:t.field,children:[e.jsx("label",{className:t.label,children:"Enter product name"}),e.jsx("input",{className:t.input,type:"text",value:u,onChange:a=>{_(a.target.value),x(null)},placeholder:"Eggplant"}),f.length>0&&e.jsx("ul",{className:t.suggestions,children:f.map(a=>e.jsx("li",{onClick:()=>$(a),className:t.suggestionItem,children:a.title},a._id))})]}),e.jsxs("div",{className:t.fieldSmall,children:[e.jsx("label",{className:t.label,children:"Grams"}),e.jsx("input",{className:t.input,type:"number",min:"1",value:m,onChange:a=>A(a.target.value),placeholder:"100"})]}),e.jsx("button",{type:"submit",className:t.addBtnCircle,disabled:!o||!m||G,children:"+"})]}),w&&e.jsx("p",{className:t.error,children:w}),S&&e.jsx("p",{className:t.warning,children:S})]}),e.jsx("div",{className:t.tableWrapper,children:Y?e.jsx("p",{children:"Loading day..."}):T.length===0?e.jsx("p",{className:t.emptyText,children:"You have not added any products yet."}):e.jsxs("table",{className:t.table,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Product"}),e.jsx("th",{children:"Grams"}),e.jsx("th",{children:"kcal"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:T.map(a=>e.jsxs("tr",{children:[e.jsx("td",{children:a.title}),e.jsx("td",{children:a.weight}),e.jsx("td",{children:Math.round(a.calories)}),e.jsx("td",{children:e.jsx("button",{type:"button",className:t.deleteBtn,onClick:()=>J(a.id),children:"✕"})})]},a.id))})]})}),g&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:t.addBtnCircle,onClick:()=>C(!0),children:"+"}),e.jsx("div",{className:t.summaryBox,children:e.jsx(F,{date:I,dailyRate:c,consumed:j,forbiddenFoods:D,percentOfNormal:O})})]})]}),!g&&e.jsx("div",{className:t.right,children:e.jsx("div",{className:t.summaryBox,children:e.jsx(F,{date:I,dailyRate:c,consumed:j,forbiddenFoods:D,percentOfNormal:O})})})]})}):e.jsx(V,{to:"/login",replace:!0})};export{Ee as default};
